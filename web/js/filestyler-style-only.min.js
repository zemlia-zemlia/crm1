/**
 * FileStyler Legacy
 * @see https://github.com/paulzi/filestyler
 * @license MIT (https://github.com/paulzi/filestyler/blob/master/LICENSE)
 * @version 0.1.2
 */

!function(a,b){"function"==typeof define&&define.amd?define("filestyler",["jquery"],function(a){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){"use strict";function b(){return null===p&&(p="multiple"in document.createElement("input")),p}function c(b,c,d){var e;return e=a.Event(j+c),d&&a.extend(e,d),b.trigger(e),e.isDefaultPrevented()}function d(b){var c=a(this).closest(l).data(j);if(c){var d,e;e=b.target,d=e.files,void 0===d&&(d=[{name:b.target.value.split("\\").pop()}]),c.processFiles(d,e)}}function e(b){b.preventDefault();var c=a(this).closest(l).data(j),d=a(this).closest(m);c.removeItem(d[0])}function f(b){b.preventDefault(),a(this).closest(l).data(j).clear()}function g(b){b.preventDefault(),a(this).closest(l).data(j).$input.trigger("click")}function h(a,b){a.config.moveInputOnDrag&&(b.data(j+"Input",[a.$input.parent(),a.$input.next()]),a.$input.addClass(j+"__drop-input"),b.append(a.$input))}function i(a,b){if(a.config.moveInputOnDrag){var c=b.data(j+"Input");c[1].length?c[1].before(a.$input):c[0].append(a.$input),a.$input.removeClass(j+"__drop-input")}}var j="filestyler",k=j+"__item",l="."+j,m="."+k,n="default",o=a(document),p=null,q=function(h){var i,k,m,o,p,r,s,t;for(o=this,o.config=a.extend({},q[n],h),o.$element=i=a(h.element),o.$file=k=i.find(l+"__file").slice(1).remove().addBack().first(),o.$input=m=k.find(l+"__input"),o.$list=i.find(l+"__list"),r=o.config.mode,"byOne"===r&&(m.removeAttr("multiple").prop("multiple",!1),o.cloneMode="item"),("add"===r||"default"===r&&!b())&&(o.cloneMode="after"),o.plugins={},p=0;p<o.config.plugins.length;p++){if(t=o.config.plugins[p],!(s=q.plugins[t]))throw new Error("Plugin "+t+" of FileStyler not found");s=s.create(o),s&&(o.plugins[t]=s)}m.on("change",d),i.on("click",l+"__remove",e),i.on("click",l+"__clear",f),i.on("click",l+"__add",g),i.data(j,o).removeClass(j+"_uninitialized").addClass(j+"_initialized").addClass(j+"_mode_"+o.config.mode),c(i,"Init")};q.prototype.callPlugins=function(b,c){var d=this;a.each(this.plugins,function(e,f){if(f[b]){var g=a.isPlainObject(f)?d:f;f[b].apply(g,c)}})},q.prototype.processFiles=function(a,e){var f,g,h,i,k;if(i=this,!c(i.$element,"BeforeProcess",{files:a,input:e})){for(k=i.config.firstItemInsertBefore,"default"===i.config.mode&&b()&&i.$element.find(m).remove(),i.callPlugins("beforeProcess",[a,e]),f=0;f<a.length;f++)g=i.createItem(a[f],e),h=i.$element.find(m).last(),h.length?h.after(g):(!0===k&&i.$list.prepend(g),!1===k&&i.$list.append(g),i.$list.find(k).before(g)),c(g,"ItemAdd",{item:g[0],file:a[f],input:e});if(i.cloneMode){var l=i.$input.clone(!1).val("");i.$input.addClass(j+"__hidden").after(l),"item"===i.cloneMode?g.append(i.$input):i.$file.before(i.$input),i.$input=l,l.on("change",d)}i.$element.removeClass(j+"_empty"),i.callPlugins("afterProcess",[a,e]),c(i.$element,"Process",{files:a,input:e})}},q.prototype.createItem=function(b,d){var e=this,f={filestyler:e,file:b,fileSizeFormatted:e.config.fileSizeFormatter(b.size,e.config.fileSizeLabels),plugins:{}};e.callPlugins("processFile",[f,b,d]);var g=a(e.config.template(f));if(g.addClass(k),b.type){var h=e.config.mimeMap[b.type];void 0===h&&(h=k+"_"+b.type.replace(/[^\w\d_-]/g,"-")),g.addClass(h)}return e.callPlugins("processItem",[g[0],f,b,d]),c(e.$element,"ProcessItem",{item:g[0],data:f,file:b,input:d}),g},q.prototype.removeItem=function(b){if(-1!==["default","add"].indexOf(this.config.mode))throw new Error('Mode "'+this.config.mode+'" does not support remove item');c(a(b),"BeforeRemoveItem",{item:b})||(this.callPlugins("removeItem",[b]),a(b).remove(),this.$element.toggleClass(j+"_empty",0===this.$list.find(m).length),c(this.$element,"RemoveItem",{item:b}))},q.prototype.clear=function(){c(this.$element,"BeforeClear")||(this.callPlugins("clear",[]),this.$element.find(m).remove(),this.$element.find(l+"__input").filter(l+"__hidden").remove(),this.$input.val(""),this.$element.addClass(j+"_empty"),c(this.$element,"Clear"))},q.prototype.destroy=function(){var a,b;a=this,b=a.$element,a.callPlugins("destroy",[]),a.$input.off("change",d),b.off("click",l+"__remove",e),b.off("click",l+"__clear",f),b.off("click",l+"__add",g),b.removeData(j).addClass(j+"_uninitialized").removeClass(j+"_initialized").removeClass(j+"_mode_"+a.config.mode)},q.fileSizeFormatter=function(a,b){for(var c=0;c<b.length;c++){if(a<1024||c===b.length-1)return Math.round(a)+" "+b[c];a/=1024}return""},q.defaultTemplate=function(b){var c,d;return c=a("<div>"),a.each(b.plugins,function(a,b){c.append(b)}),d=a("<div>").addClass(j+"__info").appendTo(c),a("<div>").addClass(j+"__name").append(b.file.name).appendTo(d),void 0!==b.file.size&&a("<div>").addClass(j+"__size").append(b.fileSizeFormatted).appendTo(d),void 0!==b.file.type&&a("<div>").addClass(j+"__type").append(b.file.type).appendTo(d),a('<button type="button">').addClass(j+"__remove").appendTo(c),c[0]},q.registerPlugin=function(a,b,c){q.plugins[a]=b,c&&q[n].plugins.push(a)},q.plugins={},q.autoInit=!0,q[n]={mode:"add",mimeMap:{},plugins:[],firstItemInsertBefore:!0,template:q.defaultTemplate,fileSizeFormatter:q.fileSizeFormatter,fileSizeLabels:["B","KiB","MiB","GiB","TiB","PiB"]},window.FileStyler=q;var r={create:function(){return r},getName:function(a){var b=a.config.sortHelper;return!0===b?a.$input.attr("name"):"string"==typeof b?b:"function"==typeof b?b(a):null},processFile:function(a){var b=this;if(b.config.sortHelper){var c=b.sortIndex;if(void 0===c){var d=-1;b.$list.find(l+"__sort-helper").each(function(){var a=parseInt(this.value,10)||0;d=a>d?a:d}),c=d}b.sortIndex=c+1,a.sortName=r.getName(b),a.sortValue=c+1,a.plugins.sortHelper=r.template(a)}},template:function(a){return'<input type="hidden" class="'+j+'__sort-helper" name="'+a.sortName+'" value="'+a.sortValue+'"/>'}};q.registerPlugin("sortHelper",r,!0),q[n].sortHelper=!1;var s={create:function(){return s},processFile:function(b,c){var d=this;if(b.isImage=!(!c.type||-1===a.inArray(c.type,d.config.supportedImages)),b.isImage){var e;e=window.URL||window.webkitURL,e&&(b.image=e.createObjectURL(c)),b.plugins.image=s.template()}},processItem:function(b,d,e){var f=function(d){var e=a(b);c(e,"ImageLoad",{item:b,url:d})||(e.find(l+"__image-bg").css("background-image","url("+d+")"),e.find(l+"__image").attr("src",d))};if(a(b).toggleClass(k+"_is-image",d.isImage).toggleClass(k+"_is-no-image",!d.isImage),d.image)f(d.image);else if(d.isImage&&window.FileReader){var g=new FileReader;g.onloadend=function(){f(g.result)},g.readAsDataURL(e)}},template:function(){return'<div class="'+j+"__figure "+j+'__image-bg"><img class="'+j+'__image"/></div>'}};q.registerPlugin("image",s,!0),q[n].supportedImages=["image/jpeg","image/jpg","image/png","image/gif","image/svg+xml"];var t={create:function(b){var c,d;c=b.$element.find(l+"__drop"),d=-1!==a.inArray(b.config.mode,b.config.allowDropNoInput),b.drop=0;var e=function(a){a.originalEvent.dataTransfer.files&&(b.drop=b.drop?2:1,b.drop>0&&c.addClass(j+"__drop_hint"))},f=function(a){a.originalEvent.dataTransfer.files&&(b.drop=2===b.drop?1:0,b.drop<=0&&c.removeClass(j+"__drop_hint"))},g=function(){b.drop=0,c.removeClass(j+"__drop_hint")},k=function(c){if(c.originalEvent.dataTransfer.files){var d=a(this);a(c.target).hasClass(j+"__input")||c.preventDefault();var e=d.data(j),f=d.data(j+"Prev");e||(d.addClass(j+"__drop_in"),h(b,d)),d.data(j,1===e&&f!==c.target?2:1),d.data(j+"Prev",c.target)}},m=function(c){if(c.originalEvent.dataTransfer.files){c.preventDefault();var d=a(this),e=2===d.data(j)?1:0;d.data(j,e),d.data(j+"Prev",null),e||(d.removeClass(j+"__drop_in"),i(b,d))}},n=function(a){a.preventDefault()},p=function(c){if(c.originalEvent.dataTransfer.files){var e=a(this);if(e.removeClass(j+"__drop_hint").removeClass(j+"__drop_in").data(j,0),b.drop=0,i(b,e),d&&(c.preventDefault(),b.processFiles(c.originalEvent.dataTransfer.files)),!d&&c.target!==b.$input[0])throw c.preventDefault(),new Error('Mode "'+b.config.mode+'" does not support drop files not on input element (hint: use moveInputOnDrag = true)')}},q=function(a){a.preventDefault()};return b.dropHandlers={documentDragEnter:e,documentDragLeave:f,documentDrop:g,dragEnter:k,dragLeave:m,dragOver:n,drop:p,inputDragOver:q},o.on("dragenter",e),o.on("dragleave",f),o.on("drop",g),c.on("dragenter",k),c.on("dragleave",m),c.on("dragover",n),c.on("drop",p),b.$input.on("dragover",q),t},destroy:function(){var a,b,c;a=this,b=a.dropHandlers,c=a.$element.find(l+"__drop"),o.off("dragenter",b.documentDragEnter),o.off("dragleave",b.documentDragLeave),o.off("drop",b.documentDrop),c.off("dragenter",b.dragEnter),c.off("dragleave",b.dragLeave),c.off("dragover",b.dragOver),c.off("drop",b.drop),a.$input.on("dragover",b.inputDragOver)}};q.registerPlugin("drop",t,!0),q[n].allowDropNoInput=["base64","ajax"],q[n].moveInputOnDrag=!0,a.fn.filestyler=function(b){this.each(function(){new q(a.extend({element:this},b||{},a(this).data(j)||{}))})},a(function(){q.autoInit&&a(l).filestyler()})});